<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The feed Module &mdash; GTFS Toolkit 0.11 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GTFS Toolkit 0.11 documentation" href="index.html" />
    <link rel="prev" title="The utils Module" href="utils.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="utils.html" title="The utils Module"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">GTFS Toolkit 0.11 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-gtfs_toolkit.feed">
<span id="the-feed-module"></span><h1>The feed Module<a class="headerlink" href="#module-gtfs_toolkit.feed" title="Permalink to this headline">¶</a></h1>
<p>Some tools for computing stats from a GTFS feed, assuming the feed
is valid.</p>
<p>All time estimates below were produced on a 2013 MacBook Pro with a
2.8 GHz Intel Core i7 processor and 16GB of RAM running OS 10.9.</p>
<p>TODO:</p>
<ul class="simple">
<li>Possibly scoop out main logic from <tt class="docutils literal"><span class="pre">Feed.get_stops_stats()</span></tt> and 
<tt class="docutils literal"><span class="pre">Feed.get_stops_time_series()</span></tt> and put it into top level functions
for the sake of greater flexibility.  Similar to what i did for 
<tt class="docutils literal"><span class="pre">Feed.get_routes_stats()</span></tt> and <tt class="docutils literal"><span class="pre">Feed.get_routes_time_series()</span></tt>.</li>
<li>Possibly add the option in <tt class="docutils literal"><span class="pre">export()</span></tt> to convert back to original distance units.</li>
</ul>
<dl class="class">
<dt id="gtfs_toolkit.feed.Feed">
<em class="property">class </em><tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">Feed</tt><big>(</big><em>path</em>, <em>original_units='km'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.object</span></tt></p>
<p>A class to gather all the GTFS files for a feed and store them in memory 
as Pandas data frames.  
Make sure you have enough memory!  
The stop times object can be big.</p>
<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.add_dist_to_shapes">
<tt class="descname">add_dist_to_shapes</tt><big>(</big><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.add_dist_to_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Add/overwrite the optional <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> GTFS field for
<tt class="docutils literal"><span class="pre">self.shapes</span></tt>.</p>
<p>NOTE:</p>
<p>Takes about 0.33 minutes on the Portland feed.
All of the calculated <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> values 
for the Portland feed differ by at most 0.016 km in absolute values
from of the original values.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.add_dist_to_stop_times">
<tt class="descname">add_dist_to_stop_times</tt><big>(</big><em>trips_stats</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.add_dist_to_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Add/overwrite the optional <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> GTFS field in
<tt class="docutils literal"><span class="pre">self.stop_times</span></tt>.
Doesn&#8217;t always give accurate results, as described below.</p>
<p>ALGORITHM:</p>
<p>Compute the <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> field by using Shapely to measure 
the distance of a stop along its trip linestring.
If for a given trip this process produces a non-monotonically 
increasing, hence incorrect, list of (cumulative) distances, then
fall back to estimating the distances as follows.</p>
<p>Get the average speed of the trip via <tt class="docutils literal"><span class="pre">trips_stats</span></tt> and
use is to linearly interpolate distances for stop times, 
assuming that the first stop is at shape_dist_traveled = 0
(the start of the shape) and the last stop is 
at shape_dist_traveled = the length of the trip 
(taken from trips_stats and equal to the length of the shape,
unless trips_stats was called with <tt class="docutils literal"><span class="pre">get_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></tt>).
This fallback method usually kicks in on trips with self-intersecting
linestrings.
Unfortunately, this fallback method will produce incorrect results
when the first stop does not start at the start of its shape
(so shape_dist_traveled != 0).
This is the case for several trips in the Portland feed, for example.</p>
<p>NOTE:</p>
<p>Takes about 0.75 minutes on the Portland feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.dump_all_stats">
<tt class="descname">dump_all_stats</tt><big>(</big><em>directory</em>, <em>date=None</em>, <em>freq='1H'</em>, <em>split_directions=False</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.dump_all_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Into the given directory, dump to separate CSV files the outputs of</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">self.get_stops_stats(date)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">self.get_stops_time_series(date)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">trips_stats</span> <span class="pre">=</span> <span class="pre">self.get_trips_stats()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">self.get_routes_stats(trips_stats,</span> <span class="pre">date)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">self.get_routes_time_series(date)</span></tt></li>
</ul>
<p>where each time series is resampled to the given frequency.
Also include a <tt class="docutils literal"><span class="pre">README.txt</span></tt> file that contains a few notes
on units and include some useful charts.</p>
<p>If no date (string of the form &#8216;%Y%m%d&#8217;) is given, 
then use the busiest day of the first week of the feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.export">
<tt class="descname">export</tt><big>(</big><em>path</em>, <em>ndigits=5</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.export" title="Permalink to this definition">¶</a></dt>
<dd><p>Export this feed to a zip archive located at <tt class="docutils literal"><span class="pre">path</span></tt>.
Round all decimals to <tt class="docutils literal"><span class="pre">ndigits</span></tt> decimal places.
All distances will be displayed in kilometers.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_active_stops">
<tt class="descname">get_active_stops</tt><big>(</big><em>date</em>, <em>time=None</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_active_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the section of <tt class="docutils literal"><span class="pre">self.stops</span></tt> that contains
only stops active on the given date (string of the form &#8216;%Y%m%d&#8217;).
If a time is given in the form of a GTFS time string &#8216;%H:%M:%S&#8217;,
then return only those stops that have a departure time at
that date and time.
Do not take times modulo 24.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_active_trips">
<tt class="descname">get_active_trips</tt><big>(</big><em>date</em>, <em>time=None</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_active_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the section of <tt class="docutils literal"><span class="pre">self.trips</span></tt> that contains
only trips active on the given date (string of the form &#8216;%Y%m%d&#8217;).
If a time is given in the form of a GTFS time string %H:%M:%S,
then return only those trips active at that date and time.
Do not take times modulo 24.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_busiest_date_of_first_week">
<tt class="descname">get_busiest_date_of_first_week</tt><big>(</big><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_busiest_date_of_first_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Consider the dates in <tt class="docutils literal"><span class="pre">self.get_first_week()</span></tt> and 
return the first date that has the maximum number of active trips.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_dates">
<tt class="descname">get_dates</tt><big>(</big><em>as_date_obj=False</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a chronologically ordered list of date strings
in the form &#8216;%Y%m%d&#8217; for which this feed is valid.
If <tt class="docutils literal"><span class="pre">as_date_obj</span> <span class="pre">==</span> <span class="pre">True</span></tt>, then return the dates as
as <tt class="docutils literal"><span class="pre">datetime.date</span></tt> objects.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_first_week">
<tt class="descname">get_first_week</tt><big>(</big><em>as_date_obj=False</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_first_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of date strings in the form &#8216;%Y%m%d&#8217; corresponding
to the first Monday&#8211;Sunday week for which this feed is valid.
In the unlikely event that this feed does not cover a full 
Monday&#8211;Sunday week, then return whatever initial segment of the 
week it does cover. 
If <tt class="docutils literal"><span class="pre">as_date_obj</span> <span class="pre">==</span> <span class="pre">True</span></tt>, then return the dates as
as <tt class="docutils literal"><span class="pre">datetime.date</span></tt> objects.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_linestring_by_shape">
<tt class="descname">get_linestring_by_shape</tt><big>(</big><em>use_utm=True</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_linestring_by_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure
shape_id -&gt; Shapely linestring of shape.
If <tt class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></tt>, then return <tt class="docutils literal"><span class="pre">None</span></tt>.
If <tt class="docutils literal"><span class="pre">use_utm</span> <span class="pre">==</span> <span class="pre">True</span></tt>, then return each linestring in
in UTM coordinates.
Otherwise, return each linestring in WGS84 longitude-latitude
coordinates.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_point_by_stop">
<tt class="descname">get_point_by_stop</tt><big>(</big><em>use_utm=True</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_point_by_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure
stop_id -&gt; Shapely point object.
If <tt class="docutils literal"><span class="pre">use_utm</span> <span class="pre">==</span> <span class="pre">True</span></tt>, then return each point in
in UTM coordinates.
Otherwise, return each point in WGS84 longitude-latitude
coordinates.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_routes_stats">
<tt class="descname">get_routes_stats</tt><big>(</big><em>trips_stats</em>, <em>date</em>, <em>split_directions=False</em>, <em>headway_start_timestr='07:00:00'</em>, <em>headway_end_timestr='19:00:00'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_routes_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Take <tt class="docutils literal"><span class="pre">trips_stats</span></tt>, which is the output of 
<tt class="docutils literal"><span class="pre">self.get_trips_stats()</span></tt>, cut it down to the subset <tt class="docutils literal"><span class="pre">S</span></tt> of trips
that are active on the given date, and then call
<tt class="docutils literal"><span class="pre">get_routes_stats()</span></tt> with <tt class="docutils literal"><span class="pre">S</span></tt> and the keyword arguments
<tt class="docutils literal"><span class="pre">split_directions</span></tt>, <tt class="docutils literal"><span class="pre">headway_start_timestr</span></tt>, and 
<tt class="docutils literal"><span class="pre">headway_end_timestr</span></tt>.</p>
<p>See <tt class="docutils literal"><span class="pre">get_routes_stats()</span></tt> for a description of the output.</p>
<p>NOTES:</p>
<p>A more user-friendly version of <tt class="docutils literal"><span class="pre">get_routes_stats()</span></tt>.
The latter function works without a feed, though.
Takes about 0.02 minutes on the Portland feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_routes_time_series">
<tt class="descname">get_routes_time_series</tt><big>(</big><em>trips_stats</em>, <em>date</em>, <em>split_directions=False</em>, <em>freq='5Min'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_routes_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Take <tt class="docutils literal"><span class="pre">trips_stats</span></tt>, which is the output of 
<tt class="docutils literal"><span class="pre">self.get_trips_stats()</span></tt>, cut it down to the subset <tt class="docutils literal"><span class="pre">S</span></tt> of trips
that are active on the given date, and then call
<tt class="docutils literal"><span class="pre">Feed.get_routes_time_series_0()</span></tt> with <tt class="docutils literal"><span class="pre">S</span></tt> and the given 
keyword arguments <tt class="docutils literal"><span class="pre">split_directions</span></tt> and <tt class="docutils literal"><span class="pre">freq</span></tt>
and with <tt class="docutils literal"><span class="pre">date_label</span> <span class="pre">=</span> <span class="pre">utils.date_to_str(date)</span></tt>.</p>
<p>See <tt class="docutils literal"><span class="pre">Feed.get_routes_time_series()</span></tt> for a description of the output.</p>
<p>If there are no active trips on the date, then return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>NOTES:</p>
<p>A more user-friendly version of <tt class="docutils literal"><span class="pre">get_routes_time_series()</span></tt>.
The latter function works without a feed, though.
Takes about 0.03 minutes on the Portland feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_stations_stats">
<tt class="descname">get_stations_stats</tt><big>(</big><em>date</em>, <em>split_directions=False</em>, <em>headway_start_timestr='07:00:00'</em>, <em>headway_end_timestr='19:00:00'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_stations_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>If this feed has station data, that is, &#8216;location_type&#8217; and
&#8216;parent_station&#8217; columns in <tt class="docutils literal"><span class="pre">self.stops</span></tt>, then compute
the same stats that <tt class="docutils literal"><span class="pre">self.get_stops_stats()</span></tt> does, but for
stations.
Otherwise, return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>NOTES:</p>
<p>Takes about 0.2 minutes on the Portland feed given the first
five weekdays of the feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_stops_activity">
<tt class="descname">get_stops_activity</tt><big>(</big><em>dates</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_stops_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Pandas data frame with the columns</p>
<ul class="simple">
<li>stop_id</li>
<li>dates[0]: a series of ones and zeros indicating if a 
stop has stop times on this date (1) or not (0)</li>
<li>etc.</li>
<li>dates[-1]: ditto</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">dates</span> <span class="pre">is</span> <span class="pre">None</span></tt>, then return <tt class="docutils literal"><span class="pre">None</span></tt>.
Dates are represented as strings of the form &#8216;%Y%m%d&#8217;.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_stops_in_stations">
<tt class="descname">get_stops_in_stations</tt><big>(</big><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_stops_in_stations" title="Permalink to this definition">¶</a></dt>
<dd><p>If this feed has station data, that is, &#8216;location_type&#8217; and
&#8216;parent_station&#8217; columns in <tt class="docutils literal"><span class="pre">self.stops</span></tt>, then return a Pandas
data frame that has the same columns as <tt class="docutils literal"><span class="pre">self.stops</span></tt>
but only includes stops with parent stations, that is, stops with
location type 0 or blank and nonblank parent station.
Otherwise, return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_stops_stats">
<tt class="descname">get_stops_stats</tt><big>(</big><em>date</em>, <em>split_directions=False</em>, <em>headway_start_timestr='07:00:00'</em>, <em>headway_end_timestr='19:00:00'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_stops_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Pandas data frame with the following columns:</p>
<ul class="simple">
<li>stop_id</li>
<li>direction_id</li>
<li>num_vehicles: number of vehicles visiting stop</li>
<li>max_headway: durations (in minuts) between 
vehicle departures at the stop between <tt class="docutils literal"><span class="pre">headway_start_timestr</span></tt> and 
<tt class="docutils literal"><span class="pre">headway_end_timestr</span></tt> on the given date</li>
<li>mean_headway: durations (in minutes) between 
vehicle departures at the stop between <tt class="docutils literal"><span class="pre">headway_start_timestr</span></tt> and 
<tt class="docutils literal"><span class="pre">headway_end_timestr</span></tt> on the given date</li>
<li>start_time: earliest departure time of a vehicle from this stop
on the given date</li>
<li>end_time: latest departure time of a vehicle from this stop
on the given date</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></tt>, then compute each stop&#8217;s stats
using vehicles visiting it from both directions.
The input <tt class="docutils literal"><span class="pre">date</span></tt> must be a string of the form &#8216;%Y%m%d&#8217;.</p>
<p>NOTES:</p>
<p>Takes about 0.7 minutes on the Portland feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_stops_time_series">
<tt class="descname">get_stops_time_series</tt><big>(</big><em>date</em>, <em>split_directions=False</em>, <em>freq='5Min'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_stops_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a time series version of the following stops stats
for the given date (string of the form &#8216;%Y%m%d&#8217;):</p>
<ul class="simple">
<li>number of vehicles by stop ID</li>
</ul>
<p>The time series is a Pandas data frame with a timestamp index 
for the 24-hour period on the given date sampled at 
the given frequency.
The maximum allowable frequency is 1 minute.</p>
<p>Using a period index instead of a timestamp index would be more
apppropriate, but 
<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#period">Pandas 0.14.1 doesn&#8217;t support period index frequencies at multiples of DateOffsets (e.g. &#8216;5Min&#8217;)</a>.</p>
<p>The columns of the data frame are hierarchical (multi-index) with</p>
<ul class="simple">
<li>top level: name = &#8216;indicator&#8217;, values = [&#8216;num_vehicles&#8217;]</li>
<li>middle level: name = &#8216;stop_id&#8217;, values = the active stop IDs</li>
<li>bottom level: name = &#8216;direction_id&#8217;, values = 0s and 1s</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></tt>, then don&#8217;t include the bottom level.</p>
<p>If there are no active trips on the date, then return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>NOTES:</p>
<ul class="simple">
<li>&#8216;num_vehicles&#8217; should be resampled with <tt class="docutils literal"><span class="pre">how=np.sum</span></tt></li>
<li>To remove the date and seconds from 
the time series f, do <tt class="docutils literal"><span class="pre">f.index</span> <span class="pre">=</span> <span class="pre">[t.time().strftime('%H:%M')</span> 
<span class="pre">for</span> <span class="pre">t</span> <span class="pre">in</span> <span class="pre">f.index.to_datetime()]</span></tt></li>
<li>Takes about 0.25 minutes on the Portland feed.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_trips_activity">
<tt class="descname">get_trips_activity</tt><big>(</big><em>dates</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_trips_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Pandas data frame with the columns</p>
<ul class="simple">
<li>trip_id</li>
<li>route_id</li>
<li>direction_id</li>
<li>dates[0]: a series of ones and zeros indicating if a 
trip is active (1) on the given date or inactive (0)</li>
<li>etc.</li>
<li>dates[-1]: ditto</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">dates</span> <span class="pre">is</span> <span class="pre">None</span></tt>, then return <tt class="docutils literal"><span class="pre">None</span></tt>.
Dates are strings of the form &#8216;%Y%m%d&#8217;.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_trips_stats">
<tt class="descname">get_trips_stats</tt><big>(</big><em>get_dist_from_shapes=False</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_trips_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Pandas data frame with the following columns:</p>
<ul class="simple">
<li>trip_id</li>
<li>direction_id</li>
<li>route_id</li>
<li>shape_id</li>
<li>start_time: first departure time of the trip</li>
<li>end_time: last departure time of the trip</li>
<li>duration: duration of the trip in hours</li>
<li>start_stop_id: stop ID of the first stop of the trip</li>
<li>end_stop_id: stop ID of the last stop of the trip</li>
<li>num_stops: number of stops on trip</li>
<li>distance: distance of the trip in kilometers; contains all <tt class="docutils literal"><span class="pre">np.nan</span></tt>
entries if <tt class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></tt></li>
</ul>
<p>NOTES:</p>
<p>If <tt class="docutils literal"><span class="pre">self.stop_times</span></tt> has a <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> column
and <tt class="docutils literal"><span class="pre">get_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></tt>,
then use that column to compute the distance column (in km).
Elif <tt class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></tt>, then compute the distance 
column using the shapes and Shapely. 
Otherwise, set the distances to <tt class="docutils literal"><span class="pre">np.nan</span></tt>.</p>
<p>Takes about 0.13 minutes on the Portland feed, which has the
<tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt> column.
Using <tt class="docutils literal"><span class="pre">get_dist_from_shapes=True</span></tt> on the Portland feed, yields 
a maximum absolute difference of 0.75 km from using 
<tt class="docutils literal"><span class="pre">get_dist_from_shapes=True</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.get_vehicles_locations">
<tt class="descname">get_vehicles_locations</tt><big>(</big><em>linestring_by_shape</em>, <em>date</em>, <em>times</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.get_vehicles_locations" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Pandas data frame of the positions of all trips
active on the given date and times.
Include the columns:</p>
<ul class="simple">
<li>trip_id</li>
<li>direction_id</li>
<li>route_id</li>
<li>time</li>
<li>rel_dist: number between 0 (start) and 1 (end) indicating 
the relative distance of the vehicle along its path</li>
<li>lon: longitude of vehicle at given time</li>
<li>lat: latitude of vehicle at given time</li>
</ul>
<p>Requires input <tt class="docutils literal"><span class="pre">linestring_by_shape</span> <span class="pre">=</span> <span class="pre">self.get_linestring_from_shape(use_utm=False)</span></tt>.
Assume <tt class="docutils literal"><span class="pre">self.stop_times</span></tt> has an accurate <tt class="docutils literal"><span class="pre">shape_dist_traveled</span></tt>
column.</p>
<p>NOTES:</p>
<p>On the Portland feed, can do 24*60 times (minute frequency)
in 0.28 min.</p>
</dd></dl>

<dl class="method">
<dt id="gtfs_toolkit.feed.Feed.is_active_trip">
<tt class="descname">is_active_trip</tt><big>(</big><em>trip</em>, <em>date</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.Feed.is_active_trip" title="Permalink to this definition">¶</a></dt>
<dd><p>If the given trip (trip ID) is active on the given date 
(string of the form &#8216;%Y%m%d&#8217;), then return <tt class="docutils literal"><span class="pre">True</span></tt>.
Otherwise, return <tt class="docutils literal"><span class="pre">False</span></tt>.
To avoid error checking in the interest of speed, 
assume <tt class="docutils literal"><span class="pre">trip</span></tt> is a valid trip ID in the feed and 
<tt class="docutils literal"><span class="pre">date</span></tt> is a valid date object.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.agg_routes_stats">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">agg_routes_stats</tt><big>(</big><em>routes_stats</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.agg_routes_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Given <tt class="docutils literal"><span class="pre">route_stats</span></tt> which is the output of <tt class="docutils literal"><span class="pre">get_routes_stats()</span></tt>,
return a Pandas data frame with the following columns:</p>
<ul class="simple">
<li>direction_id</li>
<li>num_trips: the sum of the corresponding column in the
input across all routes</li>
<li>start_time: the minimum of the corresponding column of the input
across all routes</li>
<li>end_time: the maximum of the corresponding column of the input
across all routes</li>
<li>service_duration: the sum of the corresponding column in the
input across all routes</li>
<li>service_distance: the sum of the corresponding column in the
input across all routes</li>
<li>service_speed: service_distance/service_distance</li>
</ul>
<p>If the input has no direction id, then the output won&#8217;t.</p>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.agg_routes_time_series">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">agg_routes_time_series</tt><big>(</big><em>routes_time_series</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.agg_routes_time_series" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.combine_time_series">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">combine_time_series</tt><big>(</big><em>time_series_dict</em>, <em>kind</em>, <em>split_directions=False</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.combine_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a dictionary of time series data frames, combine the time series
into one time series data frame with multi-index (hierarchical) columns
and return the result.
The top level columns are the keys of the dictionary and
the second and third level columns are &#8216;route_id&#8217; and &#8216;direction_id&#8217;,
if <tt class="docutils literal"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'route'</span></tt>, or &#8216;stop_id&#8217; and &#8216;direction_id&#8217;, 
if <tt class="docutils literal"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'stop'</span></tt>.
If <tt class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></tt>, then there is no third column level,
no &#8216;direction_id&#8217; column.</p>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.downsample">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">downsample</tt><big>(</big><em>time_series</em>, <em>freq</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.downsample" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample the given route or stop time series, which is the output of 
<tt class="docutils literal"><span class="pre">Feed.get_routes_time_series()</span></tt> or <tt class="docutils literal"><span class="pre">Feed.get_stops_time_series()</span></tt>, 
to the given Pandas-style frequency.
Can&#8217;t downsample to frequencies less one minute (&#8216;1Min&#8217;), because the
time series are generated with one-minute frequency.</p>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.get_routes_stats">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">get_routes_stats</tt><big>(</big><em>trips_stats_subset</em>, <em>split_directions=False</em>, <em>headway_start_timestr='07:00:00'</em>, <em>headway_end_timestr='19:00:00'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.get_routes_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of the output of <tt class="docutils literal"><span class="pre">Feed.get_trips_stats()</span></tt>, 
calculate stats for the routes in that subset.</p>
<p>Return a Pandas data frame with the following columns:</p>
<ul class="simple">
<li>route_id</li>
<li>direction_id</li>
<li>num_trips: mean daily number of trips</li>
<li>start_time: start time of the earliest active trip on 
the route</li>
<li>end_time: end time of latest active trip on the route</li>
<li>max_headway: maximum of the durations (in minutes) between 
trip starts on the route between <tt class="docutils literal"><span class="pre">headway_start_timestr</span></tt> and 
<tt class="docutils literal"><span class="pre">headway_end_timestr</span></tt> on the given dates</li>
<li>mean_headway: mean of the durations (in minutes) between 
trip starts on the route between <tt class="docutils literal"><span class="pre">headway_start_timestr</span></tt> and 
<tt class="docutils literal"><span class="pre">headway_end_timestr</span></tt> on the given dates</li>
<li>service_duration: total of the duration of each trip on 
the route in the given subset of trips; measured in hours</li>
<li>service_distance: total of the distance traveled by each trip on 
the route in the given subset of trips;
measured in kilometers; 
contains all <tt class="docutils literal"><span class="pre">np.nan</span></tt> entries if <tt class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></tt></li>
<li>service_speed: service_distance/service_duration;
measured in kilometers per hour</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></tt>, then remove the direction_id column
and compute each route&#8217;s stats, except for headways, using its trips
running in both directions. 
In this case, (1) compute max headway by taking the max of the max 
headways in both directions; 
(2) compute mean headway by taking the weighted mean of the mean
headways in both directions.</p>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.get_routes_time_series">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">get_routes_time_series</tt><big>(</big><em>trips_stats_subset</em>, <em>split_directions=False</em>, <em>freq='5Min'</em>, <em>date_label='20010101'</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.get_routes_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of the output of <tt class="docutils literal"><span class="pre">Feed.get_trips_stats()</span></tt>, 
calculate time series for the routes in that subset.</p>
<p>Return a time series version of the following route stats:</p>
<ul class="simple">
<li>number of vehicles in service by route ID</li>
<li>number of trip starts by route ID</li>
<li>service duration in hours by route ID</li>
<li>service distance in kilometers by route ID</li>
<li>service speed in kilometers per hour</li>
</ul>
<p>The time series is a Pandas data frame with a timestamp index 
for a 24-hour period sampled at the given frequency.
The maximum allowable frequency is 1 minute.
<tt class="docutils literal"><span class="pre">date_label</span></tt> is used as the date for the timestamp index.</p>
<p>Using a period index instead of a timestamp index would be more
apppropriate, but 
<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#period">Pandas 0.14.1 doesn&#8217;t support period index frequencies at multiples of DateOffsets (e.g. &#8216;5Min&#8217;)</a>.</p>
<p>The columns of the data frame are hierarchical (multi-index) with</p>
<ul class="simple">
<li>top level: name = &#8216;indicator&#8217;, values = [&#8216;service_distance&#8217;,
&#8216;service_duration&#8217;, &#8216;num_trip_starts&#8217;, 
&#8216;num_vehicles&#8217;, &#8216;service_speed&#8217;]</li>
<li>middle level: name = &#8216;route_id&#8217;, values = the active routes</li>
<li>bottom level: name = &#8216;direction_id&#8217;, values = 0s and 1s</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></tt>, then don&#8217;t include the bottom level.</p>
<p>If <tt class="docutils literal"><span class="pre">trips_stats_subset</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt> or empty, then return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>NOTES:</p>
<ul>
<li><dl class="first docutils">
<dt>To resample the resulting time series use the following methods:</dt>
<dd><ul class="first last simple">
<li>for &#8216;num_vehicles&#8217; series, use <tt class="docutils literal"><span class="pre">how=np.mean</span></tt></li>
<li>for the other series, use <tt class="docutils literal"><span class="pre">how=np.sum</span></tt></li>
<li>&#8216;service_speed&#8217; can&#8217;t be resampled and must be recalculated
from &#8216;service_distance&#8217; and &#8216;service_duration&#8217;</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">To remove the date and seconds from the 
time series f, do <tt class="docutils literal"><span class="pre">f.index</span> <span class="pre">=</span> <span class="pre">[t.time().strftime('%H:%M')</span> 
<span class="pre">for</span> <span class="pre">t</span> <span class="pre">in</span> <span class="pre">f.index.to_datetime()]</span></tt></p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.plot_headways">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">plot_headways</tt><big>(</big><em>stats</em>, <em>max_headway_limit=60</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.plot_headways" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a stops or routes stats data frame, 
return bar charts of the max and mean headways as a MatplotLib figure.
Only include the stops/routes with max headways at most 
<tt class="docutils literal"><span class="pre">max_headway_limit</span></tt> minutes.
If <tt class="docutils literal"><span class="pre">max_headway_limit</span> <span class="pre">is</span> <span class="pre">None</span></tt>, then include them all in a giant plot. 
If there are no stops/routes within the max headway limit, then return 
<tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>NOTES:</p>
<p>Take the resulting figure <tt class="docutils literal"><span class="pre">f</span></tt> and do <tt class="docutils literal"><span class="pre">f.tight_layout()</span></tt>
for a nice-looking plot.</p>
</dd></dl>

<dl class="function">
<dt id="gtfs_toolkit.feed.plot_routes_time_series">
<tt class="descclassname">gtfs_toolkit.feed.</tt><tt class="descname">plot_routes_time_series</tt><big>(</big><em>routes_time_series</em><big>)</big><a class="headerlink" href="#gtfs_toolkit.feed.plot_routes_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a routes time series data frame,
sum each time series indicator over all routes, 
plot each series indicator using MatplotLib, 
and return the resulting figure of subplots.</p>
<p>NOTES:</p>
<p>Take the resulting figure <tt class="docutils literal"><span class="pre">f</span></tt> and do <tt class="docutils literal"><span class="pre">f.tight_layout()</span></tt>
for a nice-looking plot.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="utils.html"
                        title="previous chapter">The utils Module</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/feed.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="utils.html" title="The utils Module"
             >previous</a> |</li>
        <li><a href="index.html">GTFS Toolkit 0.11 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Alexander Raichev.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>