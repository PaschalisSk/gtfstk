<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GTFSTK documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSTK  documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#conventions">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-modules">Module constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.helpers">Module helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.feed">Module feed</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gtfstk-version-documentation">
<h1>GTFSTK 7.0 Documentation<a class="headerlink" href="#gtfstk-version-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-introduction"></span><p>GTFSTK is a Python 3.5 tool kit to analyze <a class="reference external" href="https://en.wikipedia.org/wiki/GTFS">General Transit Feed Specification (GTFS)</a> data in memory without a database.
It uses Pandas and Shapely to do the heavy lifting.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Create a Python 3.5 virtual environment and <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">gtfstk</span></code>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>You can play with <code class="docutils literal"><span class="pre">ipynb/examples.ipynb</span></code> in a Jupyter notebook</p>
</div>
<div class="section" id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h2>
<p>In conformance with GTFS and unless specified otherwise, dates are encoded as date strings of the form YYMMDD and times are encoded as time strings of the form HH:MM:SS with the possibility that the hour is greater than 24.
Unless specified otherwise, &#8216;DataFrame&#8217; and &#8216;Series&#8217; refer to Pandas DataFrame and Series objects, respectively.</p>
</div>
<span id="document-modules"></span><div class="section" id="module-gtfstk.constants">
<span id="module-constants"></span><h2>Module constants<a class="headerlink" href="#module-gtfstk.constants" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="gtfstk.constants.CRS_WGS84">
<code class="descclassname">gtfstk.constants.</code><code class="descname">CRS_WGS84</code><em class="property"> = {'no_defs': True, 'datum': 'WGS84', 'ellps': 'WGS84', 'proj': 'longlat'}</em><a class="headerlink" href="#gtfstk.constants.CRS_WGS84" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.DIST_UNITS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">DIST_UNITS</code><em class="property"> = ['ft', 'mi', 'm', 'km']</em><a class="headerlink" href="#gtfstk.constants.DIST_UNITS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.DTYPE">
<code class="descclassname">gtfstk.constants.</code><code class="descname">DTYPE</code><em class="property"> = {'from_stop_id': &lt;class 'str'&gt;, 'date': &lt;class 'str'&gt;, 'parent_station': &lt;class 'str'&gt;, 'to_stop_id': &lt;class 'str'&gt;, 'end_date': &lt;class 'str'&gt;, 'route_short_name': &lt;class 'str'&gt;, 'zone_id': &lt;class 'str'&gt;, 'destination_id': &lt;class 'str'&gt;, 'service_id': &lt;class 'str'&gt;, 'shape_id': &lt;class 'str'&gt;, 'stop_code': &lt;class 'str'&gt;, 'agency_id': &lt;class 'str'&gt;, 'trip_id': &lt;class 'str'&gt;, 'route_id': &lt;class 'str'&gt;, 'fare_id': &lt;class 'str'&gt;, 'contains_id': &lt;class 'str'&gt;, 'origin_id': &lt;class 'str'&gt;, 'stop_id': &lt;class 'str'&gt;, 'start_date': &lt;class 'str'&gt;}</em><a class="headerlink" href="#gtfstk.constants.DTYPE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS</code><em class="property"> = ['agency', 'stops', 'routes', 'trips', 'stop_times', 'calendar', 'calendar_dates', 'fare_attributes', 'fare_rules', 'shapes', 'frequencies', 'transfers', 'feed_info', 'dist_units', '_trips_i', '_calendar_i', '_calendar_dates_g']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS_PRIVATE">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS_PRIVATE</code><em class="property"> = ['_trips_i', '_calendar_i', '_calendar_dates_g']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS_PRIVATE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS_PUBLIC">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS_PUBLIC</code><em class="property"> = ['agency', 'stops', 'routes', 'trips', 'stop_times', 'calendar', 'calendar_dates', 'fare_attributes', 'fare_rules', 'shapes', 'frequencies', 'transfers', 'feed_info', 'dist_units']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS_PUBLIC" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.GTFS_TABLES_OPTIONAL">
<code class="descclassname">gtfstk.constants.</code><code class="descname">GTFS_TABLES_OPTIONAL</code><em class="property"> = ['calendar_dates', 'fare_attributes', 'fare_rules', 'shapes', 'frequencies', 'transfers', 'feed_info']</em><a class="headerlink" href="#gtfstk.constants.GTFS_TABLES_OPTIONAL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.GTFS_TABLES_REQUIRED">
<code class="descclassname">gtfstk.constants.</code><code class="descname">GTFS_TABLES_REQUIRED</code><em class="property"> = ['agency', 'stops', 'routes', 'trips', 'stop_times', 'calendar']</em><a class="headerlink" href="#gtfstk.constants.GTFS_TABLES_REQUIRED" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.INT_COLUMNS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">INT_COLUMNS</code><em class="property"> = ['location_type', 'wheelchair_boarding', 'route_type', 'direction_id', 'stop_sequence', 'wheelchair_accessible', 'bikes_allowed', 'pickup_type', 'drop_off_type', 'timepoint', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday', 'exception_type', 'payment_method', 'transfers', 'shape_pt_sequence', 'exact_times', 'transfer_type', 'transfer_duration', 'min_transfer_time']</em><a class="headerlink" href="#gtfstk.constants.INT_COLUMNS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.VALID_COLUMNS_BY_TABLE">
<code class="descclassname">gtfstk.constants.</code><code class="descname">VALID_COLUMNS_BY_TABLE</code><em class="property"> = {'agency': ['agency_id', 'agency_name', 'agency_url', 'agency_timezone', 'agency_lang', 'agency_phone', 'agency_fare_url', 'agency_email'], 'stop_times': ['trip_id', 'arrival_time', 'departure_time', 'stop_id', 'stop_sequence', 'stop_headsign', 'pickup_type', 'drop_off_type', 'shape_dist_traveled', 'timepoint'], 'fare_attributes': ['fare_id', 'price', 'currency_type', 'payment_method', 'transfers', 'transfer_duration'], 'feed_info': ['feed_publisher_name', 'feed_publisher_url', 'feed_lang', 'feed_start_date', 'feed_end_date', 'feed_version'], 'shapes': ['shape_id', 'shape_pt_lat', 'shape_pt_lon', 'shape_pt_sequence', 'shape_dist_traveled'], 'frequencies': ['trip_id', 'start_time', 'end_time', 'headway_secs', 'exact_times'], 'routes': ['route_id', 'agency_id', 'route_short_name', 'route_long_name', 'route_desc', 'route_type', 'route_url', 'route_color', 'route_text_color'], 'transfers': ['from_stop_id', 'to_stop_id', 'transfer_type', 'min_transfer_time'], 'stops': ['stop_id', 'stop_code', 'stop_name', 'stop_desc', 'stop_lat', 'stop_lon', 'zone_id', 'stop_url', 'location_type', 'parent_station', 'stop_timezone', 'wheelchair_boarding'], 'trips': ['route_id', 'service_id', 'trip_id', 'trip_headsign', 'trip_short_name', 'direction_id', 'block_id', 'shape_id', 'wheelchair_accessible', 'bikes_allowed'], 'calendar_dates': ['service_id', 'date', 'exception_type'], 'fare_rules': ['fare_id', 'route_id', 'origin_id', 'destination_id', 'contains_id'], 'calendar': ['service_id', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday', 'start_date', 'end_date']}</em><a class="headerlink" href="#gtfstk.constants.VALID_COLUMNS_BY_TABLE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-gtfstk.helpers">
<span id="module-helpers"></span><h2>Module helpers<a class="headerlink" href="#module-gtfstk.helpers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="gtfstk.helpers.almost_equal">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">almost_equal</code><span class="sig-paren">(</span><em>f</em>, <em>g</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.almost_equal" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal"><span class="pre">True</span></code> if and only if the given DataFrames are equal after sorting their columns names, sorting their values, and reseting their indices.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.combine_time_series">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">combine_time_series</code><span class="sig-paren">(</span><em>time_series_dict</em>, <em>kind</em>, <em>split_directions=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.combine_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a dictionary of time series DataFrames, combine the time series
into one time series DataFrame with multi-index (hierarchical) columns
and return the result.
The top level columns are the keys of the dictionary and
the second and third level columns are &#8216;route_id&#8217; and &#8216;direction_id&#8217;,
if <code class="docutils literal"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'route'</span></code>, or &#8216;stop_id&#8217; and &#8216;direction_id&#8217;, 
if <code class="docutils literal"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'stop'</span></code>.
If <code class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></code>, then there is no third column level,
no &#8216;direction_id&#8217; column.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.compute_route_stats_base">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">compute_route_stats_base</code><span class="sig-paren">(</span><em>trip_stats_subset</em>, <em>split_directions=False</em>, <em>headway_start_time='07:00:00'</em>, <em>headway_end_time='19:00:00'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.compute_route_stats_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of the output of <code class="docutils literal"><span class="pre">Feed.compute_trip_stats()</span></code>, calculate stats for the routes in that subset.</p>
<p>Return a DataFrame with the following columns:</p>
<ul class="simple">
<li>route_id</li>
<li>route_short_name</li>
<li>route_type</li>
<li>direction_id</li>
<li>num_trips: number of trips</li>
<li>is_loop: 1 if at least one of the trips on the route has its <code class="docutils literal"><span class="pre">is_loop</span></code> field equal to 1; 0 otherwise</li>
<li>is_bidirectional: 1 if the route has trips in both directions; 0 otherwise</li>
<li>start_time: start time of the earliest trip on the route</li>
<li>end_time: end time of latest trip on the route</li>
<li>max_headway: maximum of the durations (in minutes) between trip starts on the route between <code class="docutils literal"><span class="pre">headway_start_time</span></code> and <code class="docutils literal"><span class="pre">headway_end_time</span></code> on the given dates</li>
<li>min_headway: minimum of the durations (in minutes) mentioned above</li>
<li>mean_headway: mean of the durations (in minutes) mentioned above</li>
<li>peak_num_trips: maximum number of simultaneous trips in service (for the given direction, or for both directions when <code class="docutils literal"><span class="pre">split_directions==False</span></code>)</li>
<li>peak_start_time: start time of first longest period during which the peak number of trips occurs</li>
<li>peak_end_time: end time of first longest period during which the peak number of trips occurs</li>
<li>service_duration: total of the duration of each trip on the route in the given subset of trips; measured in hours</li>
<li>service_distance: total of the distance traveled by each trip on the route in the given subset of trips; measured in wunits, that is, whatever distance units are present in trip_stats_subset; contains all <code class="docutils literal"><span class="pre">np.nan</span></code> entries if <code class="docutils literal"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></li>
<li>service_speed: service_distance/service_duration; measured in wunits per hour</li>
<li>mean_trip_distance: service_distance/num_trips</li>
<li>mean_trip_duration: service_duration/num_trips</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></code>, then remove the direction_id column and compute each route&#8217;s stats, except for headways, using its trips running in both directions. 
In this case, (1) compute max headway by taking the max of the max headways in both directions; (2) compute mean headway by taking the weighted mean of the mean headways in both directions.</p>
<p>If <code class="docutils literal"><span class="pre">trip_stats_subset</span></code> is empty, return an empty DataFrame with the columns specified above.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>: none.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.compute_route_time_series_base">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">compute_route_time_series_base</code><span class="sig-paren">(</span><em>trip_stats_subset</em>, <em>split_directions=False</em>, <em>freq='5Min'</em>, <em>date_label='20010101'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.compute_route_time_series_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of the output of <code class="docutils literal"><span class="pre">Feed.compute_trip_stats()</span></code>, calculate time series for the routes in that subset.</p>
<p>Return a time series version of the following route stats:</p>
<ul class="simple">
<li>number of trips in service by route ID</li>
<li>number of trip starts by route ID</li>
<li>service duration in hours by route ID</li>
<li>service distance in kilometers by route ID</li>
<li>service speed in kilometers per hour</li>
</ul>
<p>The time series is a DataFrame with a timestamp index for a 24-hour period sampled at the given frequency.
The maximum allowable frequency is 1 minute. 
<code class="docutils literal"><span class="pre">date_label</span></code> is used as the date for the timestamp index.</p>
<p>The columns of the DataFrame are hierarchical (multi-index) with</p>
<ul class="simple">
<li>top level: name = &#8216;indicator&#8217;, values = [&#8216;service_distance&#8217;, &#8216;service_duration&#8217;, &#8216;num_trip_starts&#8217;, &#8216;num_trips&#8217;, &#8216;service_speed&#8217;]</li>
<li>middle level: name = &#8216;route_id&#8217;, values = the active routes</li>
<li>bottom level: name = &#8216;direction_id&#8217;, values = 0s and 1s</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></code>, then don&#8217;t include the bottom level.</p>
<p>If <code class="docutils literal"><span class="pre">trip_stats_subset</span></code> is empty, then return an empty DataFrame
with the indicator columns.</p>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>The route stats are all computed a minute frequency and then downsampled to the desired frequency, e.g. hour frequency, but the kind of downsampling depends on the route stat.  For example, <code class="docutils literal"><span class="pre">num_trip_starts</span></code> for the hour is the sum of the (integer) <code class="docutils literal"><span class="pre">num_trip_starts</span></code> for each minute, but <code class="docutils literal"><span class="pre">num_trips</span></code> for the hour is the mean of (integer) <code class="docutils literal"><span class="pre">num_trips</span></code> for each minute. Downsampling by the mean makes sense in the latter case, because <code class="docutils literal"><span class="pre">num_trips</span></code> represents the number of trips in service during the hour, and not all trips that start in the hour run the entire hour.Taking the mean will weight the trip counts by the fraction of the hour for which the trips are in service.  For example, if two trips start in the hour, one runs for the entire hour, and the other runs for half the hour, then <code class="docutils literal"><span class="pre">num_trip_starts</span></code> will be 2 and <code class="docutils literal"><span class="pre">num_trips</span></code> will be 1.5 for that hour.</li>
<li><dl class="first docutils">
<dt>To resample the resulting time series use the following methods:</dt>
<dd><ul class="first last">
<li>for &#8216;num_trips&#8217; series, use <code class="docutils literal"><span class="pre">how=np.mean</span></code></li>
<li>for the other series, use <code class="docutils literal"><span class="pre">how=np.sum</span></code></li>
<li>&#8216;service_speed&#8217; can&#8217;t be resampled and must be recalculated from &#8216;service_distance&#8217; and &#8216;service_duration&#8217;</li>
</ul>
</dd>
</dl>
</li>
<li>To remove the date and seconds from the time series f, do <code class="docutils literal"><span class="pre">f.index</span> <span class="pre">=</span> <span class="pre">[t.time().strftime('%H:%M')</span> <span class="pre">for</span> <span class="pre">t</span> <span class="pre">in</span> <span class="pre">f.index.to_datetime()]</span></code></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.compute_stop_stats_base">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">compute_stop_stats_base</code><span class="sig-paren">(</span><em>stop_times</em>, <em>trip_subset</em>, <em>split_directions=False</em>, <em>headway_start_time='07:00:00'</em>, <em>headway_end_time='19:00:00'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.compute_stop_stats_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a stop times DataFrame and a subset of a trips DataFrame, return a DataFrame that provides summary stats about the stops in the (inner) join of the two DataFrames.</p>
<p>The columns of the output DataFrame are:</p>
<ul class="simple">
<li>stop_id</li>
<li>direction_id: present if and only if <code class="docutils literal"><span class="pre">split_directions</span></code></li>
<li>num_routes: number of routes visiting stop (in the given direction)</li>
<li>num_trips: number of trips visiting stop (in the givin direction)</li>
<li>max_headway: maximum of the durations (in minutes) between trip departures at the stop between <code class="docutils literal"><span class="pre">headway_start_time</span></code> and      <code class="docutils literal"><span class="pre">headway_end_time</span></code> on the given date</li>
<li>min_headway: minimum of the durations (in minutes) mentioned above</li>
<li>mean_headway: mean of the durations (in minutes) mentioned above</li>
<li>start_time: earliest departure time of a trip from this stop on the given date</li>
<li>end_time: latest departure time of a trip from this stop on the given date</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></code>, then compute each stop&#8217;s stats using trips visiting it from both directions.</p>
<p>If <code class="docutils literal"><span class="pre">trip_subset</span></code> is empty, then return an empty DataFrame with the columns specified above.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.compute_stop_time_series_base">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">compute_stop_time_series_base</code><span class="sig-paren">(</span><em>stop_times</em>, <em>trips_subset</em>, <em>split_directions=False</em>, <em>freq='5Min'</em>, <em>date_label='20010101'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.compute_stop_time_series_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a stop times DataFrame and a subset of a trips DataFrame, return a DataFrame that provides summary stats about the stops in the (inner) join of the two DataFrames.</p>
<p>The time series is a DataFrame with a timestamp index for a 24-hour period sampled at the given frequency.
The maximum allowable frequency is 1 minute.
The timestamp includes the date given by <code class="docutils literal"><span class="pre">date_label</span></code>, a date string of the form &#8216;%Y%m%d&#8217;.</p>
<p>The columns of the DataFrame are hierarchical (multi-index) with</p>
<ul class="simple">
<li>top level: name = &#8216;indicator&#8217;, values = [&#8216;num_trips&#8217;]</li>
<li>middle level: name = &#8216;stop_id&#8217;, values = the active stop IDs</li>
<li>bottom level: name = &#8216;direction_id&#8217;, values = 0s and 1s</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">split_directions</span> <span class="pre">==</span> <span class="pre">False</span></code>, then don&#8217;t include the bottom level.</p>
<p>If <code class="docutils literal"><span class="pre">trips_subset</span></code> is empty, then return an empty DataFrame with the indicator columns.</p>
<p>NOTES:</p>
<ul class="simple">
<li>&#8216;num_trips&#8217; should be resampled with <code class="docutils literal"><span class="pre">how=np.sum</span></code></li>
<li>To remove the date and seconds from the time series f, do <code class="docutils literal"><span class="pre">f.index</span> <span class="pre">=</span> <span class="pre">[t.time().strftime('%H:%M')</span> <span class="pre">for</span> <span class="pre">t</span> <span class="pre">in</span> <span class="pre">f.index.to_datetime()]</span></code></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.count_active_trips">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">count_active_trips</code><span class="sig-paren">(</span><em>trip_times</em>, <em>time</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.count_active_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a DataFrame <code class="docutils literal"><span class="pre">trip_times</span></code> containing the columns</p>
<ul class="simple">
<li>trip_id</li>
<li>start_time: start time of the trip in seconds past midnight</li>
<li>end_time: end time of the trip in seconds past midnight</li>
</ul>
<p>and a time in seconds past midnight, return the number of trips in the DataFrame that are active at the given time.
A trip is a considered active at time t if start_time &lt;= t &lt; end_time.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.datestr_to_date">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">datestr_to_date</code><span class="sig-paren">(</span><em>x</em>, <em>format_str='%Y%m%d'</em>, <em>inverse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.datestr_to_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a string object <code class="docutils literal"><span class="pre">x</span></code> representing a date in the given format,     convert it to a datetime.date object and return the result.
If <code class="docutils literal"><span class="pre">inverse</span></code>, then assume that <code class="docutils literal"><span class="pre">x</span></code> is a date object and return its corresponding string in the given format.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.downsample">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">downsample</code><span class="sig-paren">(</span><em>time_series</em>, <em>freq</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.downsample" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample the given route, stop, or feed time series, 
(outputs of <code class="docutils literal"><span class="pre">Feed.compute_route_time_series()</span></code>, 
<code class="docutils literal"><span class="pre">Feed.compute_stop_time_series()</span></code>, or <code class="docutils literal"><span class="pre">Feed.compute_feed_time_series()</span></code>,
respectively) to the given Pandas frequency.
Return the given time series unchanged if the given frequency is 
shorter than the original frequency.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.geometrize_shapes">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">geometrize_shapes</code><span class="sig-paren">(</span><em>shapes</em>, <em>use_utm=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.geometrize_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a shapes DataFrame, convert it to a GeoPandas GeoDataFrame and return the result.
The result has a &#8216;geometry&#8217; column of WGS84 line strings instead of &#8216;shape_pt_sequence&#8217;, &#8216;shape_pt_lon&#8217;, &#8216;shape_pt_lat&#8217;, and &#8216;shape_dist_traveled&#8217; columns.
If <code class="docutils literal"><span class="pre">use_utm</span></code>, then use UTM coordinates for the geometries.</p>
<p>Requires GeoPandas.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.geometrize_stops">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">geometrize_stops</code><span class="sig-paren">(</span><em>stops</em>, <em>use_utm=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.geometrize_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a stops DataFrame, convert it to a GeoPandas GeoDataFrame and return the result.
The result has a &#8216;geometry&#8217; column of WGS84 points instead of &#8216;stop_lon&#8217; and &#8216;stop_lat&#8217; columns.
If <code class="docutils literal"><span class="pre">use_utm</span></code>, then use UTM coordinates for the geometries.
Requires GeoPandas.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_convert_dist">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_convert_dist</code><span class="sig-paren">(</span><em>dist_units_in</em>, <em>dist_units_out</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.get_convert_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a function of the form</p>
<blockquote>
<div>distance in the units <code class="docutils literal"><span class="pre">dist_units_in</span></code> -&gt; 
distance in the units <code class="docutils literal"><span class="pre">dist_units_out</span></code></div></blockquote>
<p>Only supports distance units in <code class="docutils literal"><span class="pre">DIST_UNITS</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_max_runs">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_max_runs</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.get_max_runs" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of numbers, return a NumPy array of pairs (start index, end index + 1) of the runs of max value.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_max_runs</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">array([[0, 1],</span>
<span class="go">       [3, 5]])</span>
</pre></div>
</div>
<p>Assume x is not empty.
Recipe from <a class="reference external" href="http://stackoverflow.com/questions/1066758/find-length-of-sequences-of-identical-values-in-a-numpy-array">here</a></p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_peak_indices">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_peak_indices</code><span class="sig-paren">(</span><em>times</em>, <em>counts</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.get_peak_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an increasing list of times as seconds past midnight and a list of  trip counts at those times, return a pair of indices i, j such that times[i] to times[j] is the first longest time period such that for all i &lt;= x &lt; j, counts[x] is the max of counts.
Assume times and counts have the same nonzero length.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_segment_length">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_segment_length</code><span class="sig-paren">(</span><em>linestring</em>, <em>p</em>, <em>q=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.get_segment_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Shapely linestring and two Shapely points, project the points onto the linestring, and return the distance along the linestring between the two points.
If <code class="docutils literal"><span class="pre">q</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return the distance from the start of the linestring to the projection of <code class="docutils literal"><span class="pre">p</span></code>.
The distance is measured in the native coordinates of the linestring.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_utm_crs">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_utm_crs</code><span class="sig-paren">(</span><em>lat</em>, <em>lon</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.get_utm_crs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoPandas coordinate reference system (CRS) dictionary   corresponding to the UTM projection appropriate to the given WGS84    latitude and longitude.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.is_not_null">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">is_not_null</code><span class="sig-paren">(</span><em>data_frame</em>, <em>column_name</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.is_not_null" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal"><span class="pre">True</span></code> if the given DataFrame has a column of the given name (string), and there exists at least one non-NaN value in that column;  return <code class="docutils literal"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.linestring_to_utm">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">linestring_to_utm</code><span class="sig-paren">(</span><em>linestring</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.linestring_to_utm" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Shapely LineString in WGS84 coordinates, convert it to the appropriate UTM coordinates. 
If <code class="docutils literal"><span class="pre">inverse</span></code>, then do the inverse.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.time_it">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">time_it</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.time_it" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.timestr_mod24">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">timestr_mod24</code><span class="sig-paren">(</span><em>timestr</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.timestr_mod24" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFS time string in the format %H:%M:%S, return a timestring in the same format but with the hours taken modulo 24.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.timestr_to_seconds">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">timestr_to_seconds</code><span class="sig-paren">(</span><em>x</em>, <em>inverse=False</em>, <em>mod24=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.timestr_to_seconds" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a time string of the form &#8216;%H:%M:%S&#8217;, return the number of seconds  past midnight that it represents.
In keeping with GTFS standards, the hours entry may be greater than 23.
If <code class="docutils literal"><span class="pre">mod24</span></code>, then return the number of seconds modulo <code class="docutils literal"><span class="pre">24*3600</span></code>.
If <code class="docutils literal"><span class="pre">inverse</span></code>, then do the inverse operation.
In this case, if <code class="docutils literal"><span class="pre">mod24</span></code> also, then first take the number of  seconds modulo <code class="docutils literal"><span class="pre">24*3600</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.ungeometrize_shapes">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">ungeometrize_shapes</code><span class="sig-paren">(</span><em>geo_shapes</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.ungeometrize_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>The inverse of <a class="reference internal" href="#gtfstk.helpers.geometrize_shapes" title="gtfstk.helpers.geometrize_shapes"><code class="xref py py-func docutils literal"><span class="pre">geometrize_shapes()</span></code></a>.
Produces the columns:</p>
<ul class="simple">
<li>shape_id</li>
<li>shape_pt_sequence</li>
<li>shape_pt_lon</li>
<li>shape_pt_lat</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">geo_shapes</span></code> is in UTM (has a UTM CRS property), then convert UTM coordinates back to WGS84 coordinates,</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.ungeometrize_stops">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">ungeometrize_stops</code><span class="sig-paren">(</span><em>geo_stops</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.ungeometrize_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>The inverse of <a class="reference internal" href="#gtfstk.helpers.geometrize_stops" title="gtfstk.helpers.geometrize_stops"><code class="xref py py-func docutils literal"><span class="pre">geometrize_stops()</span></code></a>.    
If <code class="docutils literal"><span class="pre">geo_stops</span></code> is in UTM (has a UTM CRS property), then convert UTM coordinates back to WGS84 coordinates,</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.weekday_to_str">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">weekday_to_str</code><span class="sig-paren">(</span><em>weekday</em>, <em>inverse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.helpers.weekday_to_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a weekday, that is, an integer in <code class="docutils literal"><span class="pre">range(7)</span></code>, return it&#8217;s corresponding weekday name as a lowercase string.
Here 0 -&gt; &#8216;monday&#8217;, 1 -&gt; &#8216;tuesday&#8217;, and so on.
If <code class="docutils literal"><span class="pre">inverse</span></code>, then perform the inverse operation.</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.feed">
<span id="module-feed"></span><h2>Module feed<a class="headerlink" href="#module-gtfstk.feed" title="Permalink to this headline">¶</a></h2>
<p>This module defines the Feed class, which represents a GTFS feed as a collection of DataFrames.
Every Feed method assumes that every attribute of the feed that represents a GTFS file, such as <code class="docutils literal"><span class="pre">agency</span></code> or <code class="docutils literal"><span class="pre">stops</span></code>, is either <code class="docutils literal"><span class="pre">None</span></code> or a DataFrame with the columns required in the GTFS.</p>
<dl class="docutils">
<dt>CONVENTIONS:</dt>
<dd><ul class="first last simple">
<li>Dates are encoded as date strings of the form YYMMDD</li>
<li>Times are encoded as time strings of the form HH:MM:SS with the possibility that the hour is greater than 24</li>
<li>&#8216;DataFrame&#8217; and &#8216;Series&#8217; refer to Pandas DataFrame and Series objects, respectively</li>
</ul>
</dd>
</dl>
<dl class="class">
<dt id="gtfstk.feed.Feed">
<em class="property">class </em><code class="descclassname">gtfstk.feed.</code><code class="descname">Feed</code><span class="sig-paren">(</span><em>dist_units</em>, <em>agency=None</em>, <em>stops=None</em>, <em>routes=None</em>, <em>trips=None</em>, <em>stop_times=None</em>, <em>calendar=None</em>, <em>calendar_dates=None</em>, <em>fare_attributes=None</em>, <em>fare_rules=None</em>, <em>shapes=None</em>, <em>frequencies=None</em>, <em>transfers=None</em>, <em>feed_info=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>An instance of this class represents a not-necessarily-valid GTFS feed, where GTFS tables are stored as DataFrames.
Beware, the stop times DataFrame can be big (several gigabytes), so make sure you have enough memory to handle it.</p>
<p>Public instance attributes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">dist_units</span></code>: a string in <code class="xref py py-const docutils literal"><span class="pre">constants.DIST_UNITS</span></code>; specifies the distance units to use when calculating various stats, such as route service distance; should match the implicit distance units of the  <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> column values, if present</li>
<li><code class="docutils literal"><span class="pre">agency</span></code></li>
<li><code class="docutils literal"><span class="pre">stops</span></code></li>
<li><code class="docutils literal"><span class="pre">routes</span></code></li>
<li><code class="docutils literal"><span class="pre">trips</span></code></li>
<li><code class="docutils literal"><span class="pre">stop_times</span></code></li>
<li><code class="docutils literal"><span class="pre">calendar</span></code></li>
<li><code class="docutils literal"><span class="pre">calendar_dates</span></code></li>
<li><code class="docutils literal"><span class="pre">fare_attributes</span></code></li>
<li><code class="docutils literal"><span class="pre">fare_rules</span></code></li>
<li><code class="docutils literal"><span class="pre">shapes</span></code></li>
<li><code class="docutils literal"><span class="pre">frequencies</span></code></li>
<li><code class="docutils literal"><span class="pre">transfers</span></code></li>
<li><code class="docutils literal"><span class="pre">feed_info</span></code></li>
</ul>
<p>There are also a few private instance attributes that are derived from public attributes and are automatically updated when those public attributes change.
However, for this update to work, you must update the primary attributes like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="s1">&#39;route_short_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bingo&#39;</span>
<span class="n">feed</span><span class="o">.</span><span class="n">trips</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">trips</span>
</pre></div>
</div>
<p>and <strong>not</strong> like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="s1">&#39;route_short_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bingo&#39;</span>
</pre></div>
</div>
<p>The first way ensures that the altered trips DataFrame is saved as the new <code class="docutils literal"><span class="pre">trips</span></code> attribute, but the second way does not.</p>
<dl class="method">
<dt id="gtfstk.feed.Feed.aggregate_routes">
<code class="descname">aggregate_routes</code><span class="sig-paren">(</span><em>by='route_short_name'</em>, <em>route_id_prefix='route_'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.aggregate_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Group <code class="docutils literal"><span class="pre">self.routes</span></code> by the <code class="docutils literal"><span class="pre">by</span></code> column, and for each group</p>
<ol class="arabic simple">
<li>choose the first route in the group,</li>
<li>assign a new route ID based on the given <code class="docutils literal"><span class="pre">route_id_prefix</span></code> string and a running count, e.g. <code class="docutils literal"><span class="pre">'route_013'</span></code></li>
<li>assign all the trips associated with routes in the group to that first route.</li>
</ol>
<p>Return a new feed with the updated routes and trips.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.append_dist_to_shapes">
<code class="descname">append_dist_to_shapes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.append_dist_to_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> field in <code class="docutils literal"><span class="pre">self.shapes</span></code> in terms of the distance units <code class="docutils literal"><span class="pre">self.dist_units</span></code>.
Return the resulting Feed.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.shapes</span></code></li>
</ul>
<dl class="docutils">
<dt>NOTES: </dt>
<dd><ul class="first last simple">
<li>All of the calculated <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> values for the Portland feed <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">https://transitfeeds.com/p/trimet/43/1400947517</a> differ by at most 0.016 km in absolute values from of the original values.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.append_dist_to_stop_times">
<code class="descname">append_dist_to_stop_times</code><span class="sig-paren">(</span><em>trips_stats</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.append_dist_to_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> field in <code class="docutils literal"><span class="pre">self.stop_times</span></code> in terms of the distance units <code class="docutils literal"><span class="pre">self.dist_units</span></code>.
Need trip stats in the form output by <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_stats" title="gtfstk.feed.Feed.compute_trip_stats"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_stats()</span></code></a> for this.
Return the resulting Feed.
Does not always give accurate results, as described below.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.build_geometry_by_shape" title="gtfstk.feed.Feed.build_geometry_by_shape"><code class="xref py py-func docutils literal"><span class="pre">build_geometry_by_shape()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.build_geometry_by_stop" title="gtfstk.feed.Feed.build_geometry_by_stop"><code class="xref py py-func docutils literal"><span class="pre">build_geometry_by_stop()</span></code></a></li>
</ul>
<dl class="docutils">
<dt>ALGORITHM:</dt>
<dd><p class="first">Compute the <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> field by using Shapely to measure the distance of a stop along its trip linestring.
If for a given trip this process produces a non-monotonically    increasing, hence incorrect, list of (cumulative) distances, then   fall back to estimating the distances as follows.</p>
<p class="last">Get the average speed of the trip via <code class="docutils literal"><span class="pre">trips_stats</span></code> and use is to linearly interpolate distances for stop times, assuming that the first stop is at shape_dist_traveled = 0 (the start of the shape) and the last stop is at shape_dist_traveled = the length of the trip (taken from trips_stats and equal to the length of the shape, unless trips_stats was called with <code class="docutils literal"><span class="pre">get_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>).
This fallback method usually kicks in on trips with feed-intersecting    linestrings.
Unfortunately, this fallback method will produce incorrect results when the first stop does not start at the start of its shape (so shape_dist_traveled != 0).
This is the case for several trips in the Portland feed at <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">https://transitfeeds.com/p/trimet/43/1400947517</a>, for example.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.assess">
<code class="descname">assess</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.assess" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame of various feed indicators and values, such as the number of trips missing shapes.
The columns of the DataFrame are</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'indicator'</span></code>: string; name of an indicator, e.g. &#8216;num_trips_missing_shapes&#8217;</li>
<li><code class="docutils literal"><span class="pre">'value'</span></code>: value of the indicator, e.g. 27</li>
</ul>
<p>This is not a GTFS validator.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_geometry_by_shape">
<code class="descname">build_geometry_by_shape</code><span class="sig-paren">(</span><em>use_utm=False</em>, <em>shape_ids=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.build_geometry_by_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure shape_id -&gt; Shapely linestring of shape.
If <code class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return <code class="docutils literal"><span class="pre">None</span></code>.
If <code class="docutils literal"><span class="pre">use_utm</span></code>, then return each linestring in in UTM coordinates.
Otherwise, return each linestring in WGS84 longitude-latitude    coordinates.
If a list of shape IDs <code class="docutils literal"><span class="pre">shape_ids</span></code> is given, then only include the given shape IDs.</p>
<p>Return the empty dictionary if <code class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_geometry_by_stop">
<code class="descname">build_geometry_by_stop</code><span class="sig-paren">(</span><em>use_utm=False</em>, <em>stop_ids=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.build_geometry_by_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure stop_id -&gt; Shapely point object.
If <code class="docutils literal"><span class="pre">use_utm</span></code>, then return each point in in UTM coordinates.
Otherwise, return each point in WGS84 longitude-latitude coordinates.
If a list of stop IDs <code class="docutils literal"><span class="pre">stop_ids</span></code> is given, then only include the given stop IDs.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stops</span></code></li>
</ul>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.calendar">
<code class="descname">calendar</code><a class="headerlink" href="#gtfstk.feed.Feed.calendar" title="Permalink to this definition">¶</a></dt>
<dd><p>A public Feed attribute made into a property for easy auto-updating of private feed attributes based on the calendar DataFrame.</p>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.calendar_dates">
<code class="descname">calendar_dates</code><a class="headerlink" href="#gtfstk.feed.Feed.calendar_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>A public Feed attribute made into a property for easy auto-updating of private feed attributes based on the calendar dates DataFrame.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean">
<code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the following functions to this feed and return the resulting new feed.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_ids" title="gtfstk.feed.Feed.clean_ids"><code class="xref py py-func docutils literal"><span class="pre">clean_ids()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_stop_times" title="gtfstk.feed.Feed.clean_stop_times"><code class="xref py py-func docutils literal"><span class="pre">clean_stop_times()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_route_short_names" title="gtfstk.feed.Feed.clean_route_short_names"><code class="xref py py-func docutils literal"><span class="pre">clean_route_short_names()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.prune_dead_routes" title="gtfstk.feed.Feed.prune_dead_routes"><code class="xref py py-func docutils literal"><span class="pre">prune_dead_routes()</span></code></a></li>
</ol>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_ids">
<code class="descname">clean_ids</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.clean_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Strip whitespace from all string IDs and then replace every remaining whitespace chunk with an underscore.
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_route_short_names">
<code class="descname">clean_route_short_names</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.clean_route_short_names" title="Permalink to this definition">¶</a></dt>
<dd><p>In <code class="docutils literal"><span class="pre">self.routes</span></code>, assign &#8216;n/a&#8217; to missing route short names and strip whitespace from route short names.
Then disambiguate each route short name that is duplicated by appending &#8216;-&#8216; and its route ID.
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_stop_times">
<code class="descname">clean_stop_times</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.clean_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>In <code class="docutils literal"><span class="pre">self.stop_times</span></code>, prefix a zero to arrival and departure times if necessary.
This makes sorting by time work as expected.
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_bounds">
<code class="descname">compute_bounds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tuple (min longitude, min latitude, max longitude, max latitude) where the longitudes and latitude vary across all the stop (WGS84)coordinates.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_busiest_date">
<code class="descname">compute_busiest_date</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_busiest_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of dates, return the first date that has the maximum number of active trips.
If the list of dates is empty, then raise a <code class="docutils literal"><span class="pre">ValueError</span></code>.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_activity" title="gtfstk.feed.Feed.compute_trip_activity"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_activity()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_center">
<code class="descname">compute_center</code><span class="sig-paren">(</span><em>num_busiest_stops=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_center" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the convex hull of all the stop points of this Feed and return the centroid.
If an integer <code class="docutils literal"><span class="pre">num_busiest_stops</span></code> is given, then compute the <code class="docutils literal"><span class="pre">num_busiest_stops</span></code> busiest stops in the feed on the first Monday of the feed and return the mean of the longitudes and the mean of the latitudes of these stops, respectively.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_feed_stats">
<code class="descname">compute_feed_stats</code><span class="sig-paren">(</span><em>trips_stats</em>, <em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_feed_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Given trip stats of the form output by <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_stats" title="gtfstk.feed.Feed.compute_trip_stats"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_stats()</span></code></a> and a date, return a DataFrame including the following feed stats for the date.</p>
<ul class="simple">
<li>num_trips: number of trips active on the given date</li>
<li>num_routes: number of routes active on the given date</li>
<li>num_stops: number of stops active on the given date</li>
<li>peak_num_trips: maximum number of simultaneous trips in service</li>
<li>peak_start_time: start time of first longest period during which
the peak number of trips occurs</li>
<li>peak_end_time: end time of first longest period during which
the peak number of trips occurs</li>
<li>service_distance: sum of the service distances for the active routes</li>
<li>service_duration: sum of the service durations for the active routes</li>
<li>service_speed: service_distance/service_duration</li>
</ul>
<p>If there are no stats for the given date, return an empty DataFrame with the specified columns.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_routes" title="gtfstk.feed.Feed.get_routes"><code class="xref py py-func docutils literal"><span class="pre">get_routes()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_stops" title="gtfstk.feed.Feed.get_stops"><code class="xref py py-func docutils literal"><span class="pre">get_stops()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_feed_time_series">
<code class="descname">compute_feed_time_series</code><span class="sig-paren">(</span><em>trip_stats</em>, <em>date</em>, <em>freq='5Min'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_feed_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given trips stats (output of <code class="docutils literal"><span class="pre">feed.compute_trip_stats()</span></code>), a date, and a Pandas frequency string, return a time series of stats for this feed on the given date at the given frequency with the following columns</p>
<ul class="simple">
<li>num_trip_starts: number of trips starting at this time</li>
<li>num_trips: number of trips in service during this time period</li>
<li>service_distance: distance traveled by all active trips during
this time period</li>
<li>service_duration: duration traveled by all active trips during this
time period</li>
<li>service_speed: service_distance/service_duration</li>
</ul>
<p>If there is no time series for the given date, return an empty DataFrame with specified columns.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.compute_route_time_series" title="gtfstk.feed.Feed.compute_route_time_series"><code class="xref py py-func docutils literal"><span class="pre">compute_route_time_series()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_route_stats">
<code class="descname">compute_route_stats</code><span class="sig-paren">(</span><em>trip_stats</em>, <em>date</em>, <em>split_directions=False</em>, <em>headway_start_time='07:00:00'</em>, <em>headway_end_time='19:00:00'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_route_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a DataFrame of possibly partial trip stats for this Feed in the form output by <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_stats" title="gtfstk.feed.Feed.compute_trip_stats"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_stats()</span></code></a>, cut the stats down to the subset <code class="docutils literal"><span class="pre">S</span></code> of trips that are active on the given date.
Then call <a class="reference internal" href="#gtfstk.helpers.compute_route_stats_base" title="gtfstk.helpers.compute_route_stats_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_stats_base()</span></code></a> with <code class="docutils literal"><span class="pre">S</span></code> and the keyword arguments <code class="docutils literal"><span class="pre">split_directions</span></code>, <code class="docutils literal"><span class="pre">headway_start_time</span></code>, and  <code class="docutils literal"><span class="pre">headway_end_time</span></code>.
See <a class="reference internal" href="#gtfstk.helpers.compute_route_stats_base" title="gtfstk.helpers.compute_route_stats_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_stats_base()</span></code></a> for a description of the output.</p>
<p>Return an empty DataFrame if there are no route stats for the given trip stats and date.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.helpers.compute_route_stats_base" title="gtfstk.helpers.compute_route_stats_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_stats_base()</span></code></a></li>
</ul>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>This is a more user-friendly version of <a class="reference internal" href="#gtfstk.helpers.compute_route_stats_base" title="gtfstk.helpers.compute_route_stats_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_stats_base()</span></code></a>. The latter function works without a feed, though.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_route_time_series">
<code class="descname">compute_route_time_series</code><span class="sig-paren">(</span><em>trip_stats</em>, <em>date</em>, <em>split_directions=False</em>, <em>freq='5Min'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_route_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a DataFrame of possibly partial trip stats for this Feed in the form output by <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_stats" title="gtfstk.feed.Feed.compute_trip_stats"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_stats()</span></code></a>, cut the stats down to the subset <code class="docutils literal"><span class="pre">S</span></code> of trips that are active on the given date, then call <a class="reference internal" href="#gtfstk.helpers.compute_route_time_series_base" title="gtfstk.helpers.compute_route_time_series_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_time_series_base()</span></code></a> with <code class="docutils literal"><span class="pre">S</span></code> and the given keyword arguments <code class="docutils literal"><span class="pre">split_directions</span></code> and <code class="docutils literal"><span class="pre">freq</span></code> and with <code class="docutils literal"><span class="pre">date_label</span> <span class="pre">=</span> <span class="pre">date_to_str(date)</span></code>.</p>
<p>See <a class="reference internal" href="#gtfstk.helpers.compute_route_time_series_base" title="gtfstk.helpers.compute_route_time_series_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_time_series_base()</span></code></a> for a description of the output.</p>
<p>Return an empty DataFrame if there are no route stats for the given trip stats and date.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
</ul>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>This is a more user-friendly version of <a class="reference internal" href="#gtfstk.helpers.compute_route_time_series_base" title="gtfstk.helpers.compute_route_time_series_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_route_time_series_base()</span></code></a>. The latter function works without a feed, though.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_screen_line_counts">
<code class="descname">compute_screen_line_counts</code><span class="sig-paren">(</span><em>linestring</em>, <em>date</em>, <em>geo_shapes=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_screen_line_counts" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute all the trips active in the given feed on the given date that intersect the given Shapely LineString (with WGS84 longitude-latitude coordinates), and return a DataFrame with the columns:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal"><span class="pre">'crossing_time'</span></code>: time that the trip&#8217;s vehicle crosses the linestring; one trip could cross multiple times</li>
<li><code class="docutils literal"><span class="pre">'orientation'</span></code>: 1 or -1; 1 indicates trip travel from the left side to the right side of the screen line; -1 indicates trip travel in the  opposite direction</li>
</ul>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>Requires GeoPandas.</li>
<li>The first step is to geometrize <code class="docutils literal"><span class="pre">self.shapes</span></code> via   <code class="xref py py-func docutils literal"><span class="pre">geometrize_shapes()</span></code>. Alternatively, use the <code class="docutils literal"><span class="pre">geo_shapes</span></code> GeoDataFrame, if given.</li>
<li>Assume <code class="docutils literal"><span class="pre">self.stop_times</span></code> has an accurate <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> column.</li>
<li><dl class="first docutils">
<dt>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</dt>
<dd><ul class="first last">
<li><code class="docutils literal"><span class="pre">self.shapes</span></code>, if <code class="docutils literal"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
</dd>
</dl>
</li>
<li>Assume that trips travel in the same direction as their shapes. That restriction is part of GTFS, by the way. To calculate direction quickly and accurately, assume that the screen line is straight and doesn&#8217;t double back on itself.</li>
<li>Probably does not give correct results for trips with self-intersecting shapes.</li>
</ul>
</dd>
<dt>ALGORITHM:</dt>
<dd><ol class="first last arabic simple">
<li>Compute all the shapes that intersect the linestring.</li>
<li>For each such shape, compute the intersection points.</li>
<li>For each point p, scan through all the trips in the feed that have that shape and are active on the given date.</li>
<li>Interpolate a stop time for p by assuming that the feed has the shape_dist_traveled field in stop times.</li>
<li>Use that interpolated time as the crossing time of the trip vehicle, and compute the trip orientation to the screen line via a cross product of a vector in the direction of the screen line and a tiny vector in the direction of trip travel.</li>
</ol>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_activity">
<code class="descname">compute_stop_activity</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a  DataFrame with the columns</p>
<ul class="simple">
<li>stop_id</li>
<li><code class="docutils literal"><span class="pre">dates[0]</span></code>: 1 if the stop has at least one trip visiting it on <code class="docutils literal"><span class="pre">dates[0]</span></code>; 0 otherwise</li>
<li><code class="docutils literal"><span class="pre">dates[1]</span></code>: 1 if the stop has at least one trip visiting it on <code class="docutils literal"><span class="pre">dates[1]</span></code>; 0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal"><span class="pre">dates[-1]</span></code>: 1 if the stop has at least one trip visiting it on <code class="docutils literal"><span class="pre">dates[-1]</span></code>; 0 otherwise</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">dates</span></code> is <code class="docutils literal"><span class="pre">None</span></code> or the empty list, then return an empty DataFrame with the column &#8216;stop_id&#8217;.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_activity" title="gtfstk.feed.Feed.compute_trip_activity"><code class="xref py py-func docutils literal"><span class="pre">compute_trip_activity()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_stats">
<code class="descname">compute_stop_stats</code><span class="sig-paren">(</span><em>date</em>, <em>split_directions=False</em>, <em>headway_start_time='07:00:00'</em>, <em>headway_end_time='19:00:00'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Call <code class="docutils literal"><span class="pre">compute_stop_stats_base()</span></code> with the subset of trips active on the given date and with the keyword arguments <code class="docutils literal"><span class="pre">split_directions</span></code>,   <code class="docutils literal"><span class="pre">headway_start_time</span></code>, and <code class="docutils literal"><span class="pre">headway_end_time</span></code>.</p>
<p>See <code class="docutils literal"><span class="pre">compute_stop_stats_base()</span></code> for a description of the output.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_timtes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
</ul>
<p>NOTES:</p>
<p>This is a more user-friendly version of <code class="docutils literal"><span class="pre">compute_stop_stats_base()</span></code>.
The latter function works without a feed, though.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_time_series">
<code class="descname">compute_stop_time_series</code><span class="sig-paren">(</span><em>date</em>, <em>split_directions=False</em>, <em>freq='5Min'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Call <code class="xref py py-func docutils literal"><span class="pre">helpers.compute_stops_times_series_base()</span></code> with the subset of trips  active on the given date and with the keyword arguments <code class="docutils literal"><span class="pre">split_directions``and</span> <span class="pre">``freq</span></code> and with <code class="docutils literal"><span class="pre">date_label</span></code> equal to <code class="docutils literal"><span class="pre">date</span></code>.
See <a class="reference internal" href="#gtfstk.helpers.compute_stop_time_series_base" title="gtfstk.helpers.compute_stop_time_series_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_stop_time_series_base()</span></code></a> for a description of the output.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
</ul>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>This is a more user-friendly version of <a class="reference internal" href="#gtfstk.helpers.compute_stop_time_series_base" title="gtfstk.helpers.compute_stop_time_series_base"><code class="xref py py-func docutils literal"><span class="pre">helpers.compute_stop_time_series_base()</span></code></a>. The latter function works without a feed, though.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_trip_activity">
<code class="descname">compute_trip_activity</code><span class="sig-paren">(</span><em>dates</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_trip_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a  DataFrame with the columns</p>
<ul class="simple">
<li>trip_id</li>
<li><code class="docutils literal"><span class="pre">dates[0]</span></code>: 1 if the trip is active on <code class="docutils literal"><span class="pre">dates[0]</span></code>; 0 otherwise</li>
<li><code class="docutils literal"><span class="pre">dates[1]</span></code>: 1 if the trip is active on <code class="docutils literal"><span class="pre">dates[1]</span></code>; 0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal"><span class="pre">dates[-1]</span></code>: 1 if the trip is active on <code class="docutils literal"><span class="pre">dates[-1]</span></code>; 0 otherwise</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">dates</span></code> is <code class="docutils literal"><span class="pre">None</span></code> or the empty list, then return an empty DataFrame with the column &#8216;trip_id&#8217;.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.is_active_trip" title="gtfstk.feed.Feed.is_active_trip"><code class="xref py py-func docutils literal"><span class="pre">is_active_trip()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_trip_locations">
<code class="descname">compute_trip_locations</code><span class="sig-paren">(</span><em>date</em>, <em>times</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_trip_locations" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a  DataFrame of the positions of all trips active on the given date and times 
Include the columns:</p>
<ul class="simple">
<li>trip_id</li>
<li>route_id</li>
<li>direction_id</li>
<li>time</li>
<li>rel_dist: number between 0 (start) and 1 (end) indicating 
the relative distance of the trip along its path</li>
<li>lon: longitude of trip at given time</li>
<li>lat: latitude of trip at given time</li>
</ul>
<p>Assume <code class="docutils literal"><span class="pre">self.stop_times</span></code> has an accurate <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> column.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_stop_times" title="gtfstk.feed.Feed.get_stop_times"><code class="xref py py-func docutils literal"><span class="pre">get_stop_times()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.build_geometry_by_shape" title="gtfstk.feed.Feed.build_geometry_by_shape"><code class="xref py py-func docutils literal"><span class="pre">build_geometry_by_shape()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_trip_stats">
<code class="descname">compute_trip_stats</code><span class="sig-paren">(</span><em>compute_dist_from_shapes=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_trip_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame with the following columns:</p>
<ul class="simple">
<li>trip_id</li>
<li>route_id</li>
<li>route_short_name</li>
<li>route_type</li>
<li>direction_id</li>
<li>shape_id</li>
<li>num_stops: number of stops on trip</li>
<li>start_time: first departure time of the trip</li>
<li>end_time: last departure time of the trip</li>
<li>start_stop_id: stop ID of the first stop of the trip</li>
<li>end_stop_id: stop ID of the last stop of the trip</li>
<li>is_loop: 1 if the start and end stop are less than 400m apart and
0 otherwise</li>
<li>distance: distance of the trip in <code class="docutils literal"><span class="pre">self.dist_units</span></code>; 
contains all <code class="docutils literal"><span class="pre">np.nan</span></code> entries if <code class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></li>
<li>duration: duration of the trip in hours</li>
<li>speed: distance/duration</li>
</ul>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li><code class="docutils literal"><span class="pre">self.routes</span></code></li>
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li><code class="docutils literal"><span class="pre">self.shapes</span></code> (optionally)</li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.build_geometry_by_stop" title="gtfstk.feed.Feed.build_geometry_by_stop"><code class="xref py py-func docutils literal"><span class="pre">build_geometry_by_stop()</span></code></a></li>
</ul>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><p class="first">If <code class="docutils literal"><span class="pre">self.stop_times</span></code> has a <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> column with at least one non-NaN value and <code class="docutils literal"><span class="pre">compute_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>, then use that column to compute the distance column.
Else if <code class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>, then compute the distance column using the shapes and Shapely. 
Otherwise, set the distances to <code class="docutils literal"><span class="pre">np.nan</span></code>.</p>
<p class="last">Calculating trip distances with <code class="docutils literal"><span class="pre">compute_dist_from_shapes=True</span></code> seems pretty accurate.
For example, calculating trip distances on the Portland feed at <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">https://transitfeeds.com/p/trimet/43/1400947517</a> using <code class="docutils literal"><span class="pre">compute_dist_from_shapes=False</span></code> and <code class="docutils literal"><span class="pre">compute_dist_from_shapes=True</span></code>, yields a difference of at most 0.83km.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.convert_dist">
<code class="descname">convert_dist</code><span class="sig-paren">(</span><em>new_dist_units</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.convert_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the distances recorded in the <code class="docutils literal"><span class="pre">shape_dist_traveled</span></code> columns of the given feed from this Feed&#8217;s native distance units (recorded in <code class="docutils literal"><span class="pre">self.dist_units</span></code>) to the given new distance units.
New distance units must lie in <code class="xref py py-const docutils literal"><span class="pre">constants.DIST_UNITS</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a copy of this feed, that is, a feed with all the same public and private attributes.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.create_shapes">
<code class="descname">create_shapes</code><span class="sig-paren">(</span><em>all_trips=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.create_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a feed, create a shape for every trip that is missing a shape ID.
Do this by connecting the stops on the trip with straight lines.
Return the resulting feed which has updated shapes and trips DataFrames.</p>
<p>If <code class="docutils literal"><span class="pre">all_trips</span></code>, then create new shapes for all trips by connecting stops, and remove the old shapes.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li><code class="docutils literal"><span class="pre">self.stops</span></code></li>
</ul>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.dist_units">
<code class="descname">dist_units</code><a class="headerlink" href="#gtfstk.feed.Feed.dist_units" title="Permalink to this definition">¶</a></dt>
<dd><p>A public Feed attribute made into a property for easy validation.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.drop_invalid_columns">
<code class="descname">drop_invalid_columns</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.drop_invalid_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop all data frame columns of this feed not listed in <code class="xref py py-const docutils literal"><span class="pre">constants.VALID_COLUMNS_BY_TABLE</span></code>.
Return the resulting new feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_dates">
<code class="descname">get_dates</code><span class="sig-paren">(</span><em>as_date_obj=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a chronologically ordered list of dates (strings) for which this feed is valid.
If <code class="docutils literal"><span class="pre">as_date_obj</span></code>, then return the dates as <code class="docutils literal"><span class="pre">datetime.date</span></code> objects.</p>
<p>If <code class="docutils literal"><span class="pre">self.calendar</span></code> and <code class="docutils literal"><span class="pre">self.calendar_dates</span></code> are both <code class="docutils literal"><span class="pre">None</span></code>, then return the empty list.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_first_week">
<code class="descname">get_first_week</code><span class="sig-paren">(</span><em>as_date_obj=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_first_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of date corresponding to the first Monday&#8211;Sunday week for which this feed is valid.
If the given feed does not cover a full Monday&#8211;Sunday week, then return whatever initial segment of the week it does cover, which could be the empty list.
If <code class="docutils literal"><span class="pre">as_date_obj</span></code>, then return the dates as as <code class="docutils literal"><span class="pre">datetime.date</span></code> objects.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_route_timetable">
<code class="descname">get_route_timetable</code><span class="sig-paren">(</span><em>route_id</em>, <em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_route_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame encoding the timetable for the given route ID on the given date.
The columns are all those in <code class="docutils literal"><span class="pre">self.trips</span></code> plus those in <code class="docutils literal"><span class="pre">self.stop_times</span></code>.
The result is sorted by grouping by trip ID and sorting the groups by their first departure time.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_routes">
<code class="descname">get_routes</code><span class="sig-paren">(</span><em>date=None</em>, <em>time=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the section of <code class="docutils literal"><span class="pre">self.routes</span></code> that contains only routes active on the given date.
If no date is given, then return all routes.
If a date and time are given, then return only those routes with trips active at that date and time.
Do not take times modulo 24.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a>.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_shapes_intersecting_geometry">
<code class="descname">get_shapes_intersecting_geometry</code><span class="sig-paren">(</span><em>geometry</em>, <em>geo_shapes=None</em>, <em>geometrized=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_shapes_intersecting_geometry" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal"><span class="pre">self.shapes</span></code> that contains all shapes that intersect the given Shapely geometry object (e.g. a Polygon or LineString).
Assume the geometry is specified in WGS84 longitude-latitude coordinates.</p>
<p>To do this, first geometrize <code class="docutils literal"><span class="pre">self.shapes</span></code> via <code class="xref py py-func docutils literal"><span class="pre">geometrize_shapes()</span></code>.
Alternatively, use the <code class="docutils literal"><span class="pre">geo_shapes</span></code> GeoDataFrame, if given.
Requires GeoPandas.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.shapes</span></code>, if <code class="docutils literal"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">geometrized</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, then return the 
resulting shapes DataFrame in geometrized form.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_start_and_end_times">
<code class="descname">get_start_and_end_times</code><span class="sig-paren">(</span><em>date=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_start_and_end_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the first departure time and last arrival time (time strings) listed in <code class="docutils literal"><span class="pre">self.stop_times</span></code>, respectively.
Restrict to the given date if specified.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stop_times">
<code class="descname">get_stop_times</code><span class="sig-paren">(</span><em>date=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the section of <code class="docutils literal"><span class="pre">self.stop_times</span></code> that contains only trips active on the given date.
If no date is given, then return all stop times.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_trips" title="gtfstk.feed.Feed.get_trips"><code class="xref py py-func docutils literal"><span class="pre">get_trips()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stop_timetable">
<code class="descname">get_stop_timetable</code><span class="sig-paren">(</span><em>stop_id</em>, <em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_stop_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a  DataFrame encoding the timetable for the given stop ID on the given date.
The columns are all those in <code class="docutils literal"><span class="pre">self.trips</span></code> plus those in <code class="docutils literal"><span class="pre">self.stop_times</span></code>.
The result is sorted by departure time.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_stop_times" title="gtfstk.feed.Feed.get_stop_times"><code class="xref py py-func docutils literal"><span class="pre">get_stop_times()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stops">
<code class="descname">get_stops</code><span class="sig-paren">(</span><em>date=None</em>, <em>trip_id=None</em>, <em>route_id=None</em>, <em>in_stations=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal"><span class="pre">self.stops</span></code>.
If a date is given, then restrict the output to stops that are visited by trips active on the given date.
If a trip ID (string) is given, then restrict the output possibly further to stops that are visited by the trip.
Else if a route ID (string) is given, then restrict the output possibly further to stops that are visited by at least one trip on the route.
If <code class="docutils literal"><span class="pre">in_stations</span></code>, then restrict the output further to only include stops are within stations, if station data is available in <code class="docutils literal"><span class="pre">self.stops</span></code>.
Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stops</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_stop_times" title="gtfstk.feed.Feed.get_stop_times"><code class="xref py py-func docutils literal"><span class="pre">get_stop_times()</span></code></a></li>
<li><code class="docutils literal"><span class="pre">self.routes</span></code></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stops_in_polygon">
<code class="descname">get_stops_in_polygon</code><span class="sig-paren">(</span><em>polygon</em>, <em>geo_stops=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_stops_in_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal"><span class="pre">self.stops</span></code> that contains all stops that lie within the given Shapely Polygon object.
Assume the polygon specified in WGS84 longitude-latitude coordinates.</p>
<p>To do this, first geometrize <code class="docutils literal"><span class="pre">self.stops</span></code> via <code class="xref py py-func docutils literal"><span class="pre">geometrize_stops()</span></code>.
Alternatively, use the <code class="docutils literal"><span class="pre">geo_stops</span></code> GeoDataFrame, if given.
Requires GeoPandas.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.stops</span></code>, if <code class="docutils literal"><span class="pre">geo_stops</span></code> is not given</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_trips">
<code class="descname">get_trips</code><span class="sig-paren">(</span><em>date=None</em>, <em>time=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.get_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the section of <code class="docutils literal"><span class="pre">self.trips</span></code> that contains only trips active on the given date.
If <code class="docutils literal"><span class="pre">self.trips</span></code> is <code class="docutils literal"><span class="pre">None</span></code> or the date is <code class="docutils literal"><span class="pre">None</span></code>, then return all <code class="docutils literal"><span class="pre">self.trips</span></code>.
If a date and time are given, then return only those trips active at that date and time.
Do not take times modulo 24.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.is_active_trip">
<code class="descname">is_active_trip</code><span class="sig-paren">(</span><em>trip_id</em>, <em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.is_active_trip" title="Permalink to this definition">¶</a></dt>
<dd><p>If the given trip is active on the given date, then return <code class="docutils literal"><span class="pre">True</span></code>; otherwise return <code class="docutils literal"><span class="pre">False</span></code>.
To avoid error checking in the interest of speed, assume <code class="docutils literal"><span class="pre">trip</span></code> is a valid trip ID in the given feed and <code class="docutils literal"><span class="pre">date</span></code> is a valid date object.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
</ul>
<dl class="docutils">
<dt>NOTES: </dt>
<dd><ul class="first last simple">
<li>This function is key for getting all trips, routes, etc. that are active on a given date, so the function needs to be fast.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.prune_dead_routes">
<code class="descname">prune_dead_routes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.prune_dead_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove every route from <code class="docutils literal"><span class="pre">self.routes</span></code> that does not have trips listed in <code class="docutils literal"><span class="pre">self.trips</span></code>.
Return the resulting new feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.restrict_to_polygon">
<code class="descname">restrict_to_polygon</code><span class="sig-paren">(</span><em>polygon</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.restrict_to_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this on to only the trips that have at least one stop intersecting the given polygon, then        restricting stops, routes, stop times, etc. to those associated with that subset of trips. 
Return the resulting feed.
Requires GeoPandas.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal"><span class="pre">feed.stops</span></code></li>
<li><code class="docutils literal"><span class="pre">feed.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.get_stops_in_polygon" title="gtfstk.feed.Feed.get_stops_in_polygon"><code class="xref py py-func docutils literal"><span class="pre">get_stops_in_polygon()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.restrict_to_routes">
<code class="descname">restrict_to_routes</code><span class="sig-paren">(</span><em>route_ids</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.restrict_to_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the stops, trips, shapes, etc. used by the routes with the given list of route IDs. 
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.route_to_geojson">
<code class="descname">route_to_geojson</code><span class="sig-paren">(</span><em>route_id</em>, <em>include_stops=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.route_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a feed and a route ID (string), return a (decoded) GeoJSON 
feature collection comprising a MultiLinestring feature of distinct shapes
of the trips on the route.
If <code class="docutils literal"><span class="pre">include_stops</span></code>, then also include one Point feature for each stop 
visited by any trip on the route. 
The MultiLinestring feature will contain as properties all the columns
in <code class="docutils literal"><span class="pre">self.routes</span></code> pertaining to the given route, and each Point feature
will contain as properties all the columns in <code class="docutils literal"><span class="pre">self.stops</span></code> pertaining 
to the stop, except the <code class="docutils literal"><span class="pre">stop_lat</span></code> and <code class="docutils literal"><span class="pre">stop_lon</span></code> properties.</p>
<p>Return the empty dictionary if all the route&#8217;s trips lack shapes.</p>
<p>Assume the following feed attributes are not <code class="docutils literal"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">self.routes</span></code></li>
<li><code class="docutils literal"><span class="pre">self.shapes</span></code></li>
<li><code class="docutils literal"><span class="pre">self.trips</span></code></li>
<li><code class="docutils literal"><span class="pre">self.stops</span></code></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.shapes_to_geojson">
<code class="descname">shapes_to_geojson</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.shapes_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a (decoded) GeoJSON FeatureCollection of linestring features representing <code class="docutils literal"><span class="pre">self.shapes</span></code>.
Each feature will have a <code class="docutils literal"><span class="pre">shape_id</span></code> property. 
The coordinates reference system is the default one for GeoJSON, namely WGS84.</p>
<p>Return the empty dictionary of <code class="docutils literal"><span class="pre">self.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.trip_to_geojson">
<code class="descname">trip_to_geojson</code><span class="sig-paren">(</span><em>trip_id</em>, <em>include_stops=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.trip_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a feed and a trip ID (string), return a (decoded) GeoJSON feature collection comprising a Linestring feature of representing the trip&#8217;s shape.
If <code class="docutils literal"><span class="pre">include_stops</span></code>, then also include one Point feature for each stop  visited by the trip. 
The Linestring feature will contain as properties all the columns in <code class="docutils literal"><span class="pre">self.trips</span></code> pertaining to the given trip, and each Point feature will contain as properties all the columns in <code class="docutils literal"><span class="pre">self.stops</span></code> pertaining    to the stop, except the <code class="docutils literal"><span class="pre">stop_lat</span></code> and <code class="docutils literal"><span class="pre">stop_lon</span></code> properties.</p>
<p>Return the empty dictionary if the trip has no shape.</p>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.trips">
<code class="descname">trips</code><a class="headerlink" href="#gtfstk.feed.Feed.trips" title="Permalink to this definition">¶</a></dt>
<dd><p>A public Feed attribute made into a property for easy auto-updating of private feed attributes based on the trips DataFrame.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="gtfstk.feed.read_gtfs">
<code class="descclassname">gtfstk.feed.</code><code class="descname">read_gtfs</code><span class="sig-paren">(</span><em>path</em>, <em>dist_units=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.read_gtfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Feed object from the given path and given distance units.
The path should be a directory containing GTFS text files or a zip file that unzips as a collection of GTFS text files (and not as a directory containing GTFS text files).</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.feed.write_gtfs">
<code class="descclassname">gtfstk.feed.</code><code class="descname">write_gtfs</code><span class="sig-paren">(</span><em>feed</em>, <em>path</em>, <em>ndigits=6</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.write_gtfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Export the given feed to the given path.
If the path end in &#8216;.zip&#8217;, then write the feed as a zip archive.
Otherwise assume the path is a directory, and write the feed as a collection of CSV files to that directory, creating the directory if it does not exist.
Round all decimals to <code class="docutils literal"><span class="pre">ndigits</span></code> decimal places.
All distances will be the distance units <code class="docutils literal"><span class="pre">feed.dist_units</span></code>.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSTK  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.
    </div>
  </body>
</html>